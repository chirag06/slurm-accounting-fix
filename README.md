# slurm-accounting-fix
## Introduction

This project aims at resolving the issue mentioned [here](https://gitlab.rc.uab.edu/mhanby/rc-slurm/issues/43)

To fix jobs accumulating runtime infinitely because they do not have end time, but have a completed or failed state. We would expect the jobs in the state COMPLETED or FAILED state to report the end time and have a non-zero entry in the database.

**Note**: First create a back up of your slurm accounting database and work in a local test environment.

After you place your slurm accounting database backup dump file in your local test environment, follow these steps. 

#### Steps to Restore the slurmDB
Create a slurm database before you try to restore from the mysql dumpfile and make sure you have the database you just created is listed.

`mysql -u root -e "create database slurm_acct_db; show databases;"`


Restore the database by using the following command.

`mysql slurm_acct_db -u root < <path to your DB dumpfile>`

#### Usage
**Note**: Before using this script you need to have an input file which is generated by running the following command 
`sacct -P -o jobid,state,totalcpu,timelimit,start,end,resvcpuraw --accounts 'username' > inputfile`

`./slurm-acct-db-patch inputfile` OR 

`sacct -P -o jobid,state,totalcpu,timelimit,start,end,resvcpuraw --accounts username | ./slurm-acct-db-patch > outfile.sql`
